#!/usr/bin/env bash
set -euo pipefail

OS="$(uname -s)"
DEST="$HOME/.local/bin/hey"

case "$OS" in
    Linux)        URL="https://storage.googleapis.com/hey-releases/hey_linux_amd64" ;;
    Darwin)       URL="https://storage.googleapis.com/hey-releases/hey_darwin_amd64" ;;
    MINGW*|MSYS*|CYGWIN*) URL="https://storage.googleapis.com/hey-releases/hey_windows_amd64" ;;
    *)
        echo "Unsupported OS: $OS" >&2
        exit 1
        ;;
esac

echo "Downloading hey for $OS..." >&2

TMP="$(mktemp)"
trap 'rm -f "$TMP"' EXIT

curl -fsSL -o "$TMP" "$URL"
chmod +x "$TMP"
mkdir -p "$(dirname "$DEST")"
mv "$TMP" "$DEST"

echo "Installed hey to $DEST" >&2

exec "$DEST" "$@"
